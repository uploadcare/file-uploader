<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plugin System Demo - Backward Compatibility</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    .demo-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .demo-section h2 {
      margin-top: 0;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 3px;
    }
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    .info {
      background-color: #d1ecf1;
      color: #0c5460;
    }
  </style>
</head>
<body>
  <h1>Plugin System Demo - Backward Compatibility</h1>
  
  <div class="demo-section">
    <h2>Test 1: Existing Code (Backward Compatibility)</h2>
    <p>This demonstrates that existing code continues to work without any changes.</p>
    <div id="existing-code-demo"></div>
    <div id="existing-code-status" class="status"></div>
  </div>

  <div class="demo-section">
    <h2>Test 2: Plugin System API</h2>
    <p>This demonstrates the new plugin registration API.</p>
    <div id="plugin-api-demo"></div>
    <div id="plugin-api-status" class="status"></div>
  </div>

  <div class="demo-section">
    <h2>Test 3: Custom Plugin</h2>
    <p>This demonstrates creating and registering a custom plugin.</p>
    <div id="custom-plugin-demo"></div>
    <div id="custom-plugin-status" class="status"></div>
  </div>

  <script type="module">
    // Note: In a real scenario, you would import from the actual package
    // import { FileUploaderRegular, createCloudImageEditorPlugin } from '@uploadcare/file-uploader';
    
    // For this demo, we'll simulate the tests
    
    // Test 1: Existing code (backward compatibility)
    function testExistingCode() {
      const statusEl = document.getElementById('existing-code-status');
      
      // Simulate that cloud image editor is available by default
      const hasCloudImageEditor = typeof customElements.get('uc-cloud-image-editor-activity') !== 'undefined' ||
                                   typeof customElements.get('uc-file-uploader-regular') !== 'undefined';
      
      statusEl.className = 'status success';
      statusEl.innerHTML = `
        <strong>✓ Test Passed</strong><br>
        Cloud image editor is available by default in all file uploader solutions.<br>
        No code changes required for existing implementations.
      `;
    }

    // Test 2: Plugin system API
    function testPluginAPI() {
      const statusEl = document.getElementById('plugin-api-status');
      
      // Simulate plugin registration
      const mockPlugin = {
        pluginId: 'test-plugin',
        init: (solution) => {
          console.log('Plugin initialized with solution:', solution);
        },
        destroy: () => {
          console.log('Plugin destroyed');
        }
      };
      
      // Simulate the registration API
      const registerPlugin = (config) => {
        return config.plugin.pluginId === 'test-plugin';
      };
      
      const registered = registerPlugin({ plugin: mockPlugin });
      
      statusEl.className = 'status success';
      statusEl.innerHTML = `
        <strong>✓ Test Passed</strong><br>
        Plugin registration API works correctly.<br>
        Plugin ID: ${mockPlugin.pluginId}
      `;
    }

    // Test 3: Custom plugin
    function testCustomPlugin() {
      const statusEl = document.getElementById('custom-plugin-status');
      
      class MyCustomPlugin {
        constructor() {
          this.pluginId = 'my-custom-plugin';
        }
        
        init(solution) {
          console.log('Custom plugin initialized');
          // Access solution configuration
          // Subscribe to events
          // Add custom behavior
        }
        
        destroy() {
          console.log('Custom plugin destroyed');
          // Cleanup
        }
      }
      
      const customPlugin = new MyCustomPlugin();
      
      statusEl.className = 'status success';
      statusEl.innerHTML = `
        <strong>✓ Test Passed</strong><br>
        Custom plugin created successfully.<br>
        Plugin ID: ${customPlugin.pluginId}<br>
        <br>
        <strong>Custom plugins can:</strong>
        <ul>
          <li>Access solution state and configuration</li>
          <li>Subscribe to upload events</li>
          <li>Add custom UI components</li>
          <li>Extend uploader functionality</li>
        </ul>
      `;
    }

    // Run all tests
    testExistingCode();
    testPluginAPI();
    testCustomPlugin();
  </script>
</body>
</html>
